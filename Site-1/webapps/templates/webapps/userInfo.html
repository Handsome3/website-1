<!doctype html>
<html>
<head>
{% load static %}
<meta charset="utf-8">
<title>个人中心</title>
    <link href="{% static 'webapps/image/favicon.ico' %}" rel="icon">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="{% static 'webapps/css/site.css' %}">
</head>
<body>
	{% include "webapps/header.html" %}
    <div class="container">
    <div class="row clearfix">
		<div class="col-md-12 column">
			<div class="page-header">
				<h1>
					个人中心 <small>主页</small>
				</h1>
			</div>
		</div>
	</div>
    <div class="row clearfix">
		<div class="col-md-2 column">
			<div class="panel-group" id="panel-322642">
				<div class="panel panel-default">
					<div class="panel-heading">
						 <a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-322642" href="#panel-element-461426"><label>个人信息修改</label></a>
					</div>
					<div id="panel-element-461426" class="panel-collapse collapse">
						<div class="panel-body">
							<label><a href="#">联系方式修改</a></label><br>
						</div>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						 <a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-322642" href="#panel-element-943900"><label>我发布的帖子</label></a>
					</div>
					<div id="panel-element-943900" class="panel-collapse collapse">
						<div class="panel-body">
							<label><a href="{% url 'webapps:getuserinfo' %}?type=carpool">Carpool</a></label><br>
                            <label><a href="{% url 'webapps:getuserinfo' %}?type=useditem">二手宝贝</a></label><br>
                            <label><a href="#">Sublease</a></label><br>
                            <label><a href="#">合租</a></label><br>
                            <label><a href="{% url 'webapps:getuserinfo' %}?type=usedcar">二手车</a></label><br>
                            <label><a href="#">拼单</a></label><br>
						</div>
					</div>
				</div>
                <div class="panel panel-default">
					<div class="panel-heading">
						 <a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-322642" href="#panel-element-111111"><label>我感兴趣的帖子</label></a>
					</div>
					<div id="panel-element-111111" class="panel-collapse collapse">
						<div class="panel-body">
							<label><a href="#">Carpool</a></label><br>
                            <label><a href="#">二手宝贝</a></label><br>
                            <label><a href="#">Sublease</a></label><br>
                            <label><a href="#">合租</a></label><br>
                            <label><a href="#">二手车</a></label><br>
                            <label><a href="#">拼单</a></label><br>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="col-md-10 column" style="border-left: 1px solid #eee;">
			<table class="table table-striped table-hover">
				<thead>
					<tr>
						<th>标题</th>
						<th>分类</th>
						<th>发布日期</th>
						<th>有效日期</th>
                        <th>热度</th>
                        <th>操作</th>
					</tr>
				</thead>
				<tbody id="content">
					{% for record in records %}
					<tr>
						<td>{{ record.title }}</td>
						<td>{{ record.type }}</td>
                        <td>{{ record.create_time|date:'Y-m-d' }}</td>
						<td>{{ record.expire_time|date:'Y-m-d' }}</td>
						<td>{{ record.hot_index }}</td>
						<td>
                            <a href="{% url 'webapps:getDealDetail' record.id %}" class="btn btn-xs btn-info">详情</a><br>
                            <a href="" class="btn btn-xs btn-warning">修改</a><br>
                            <a href="" class="btn btn-xs btn-danger">删除</a><br>
                        </td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
            <div class="loading" id="loading" style="display: none; height:100px;">
                <center><h3>稍候，正在加载中...</h3></center>
            </div>
            <div class="alert alert-dismissable alert-success" id="nomoreresults" style="display: none;">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <h4>注意啦！</h4>
                <strong>没有更多结果了。</strong>
            </div>
		</div>
	</div>
</div>
{% include 'webapps/footer.html' %}
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
	var start, end=10;
	var has_next={{ config.has_next|lower }};
	$(document).ready(function(){
		$(window).scroll(function(){
			if (parseFloat($(window).height()) + parseFloat($(window).scrollTop())>=$(document).height()-20 && has_next){
				$('#loading').fadeIn();
				has_next=false,
				$.ajax({
					type: 'GET',
					dataType: 'JSON',
					data: {'type': '{{ config.type }}', 'end': end},
					url: "{% url 'webapps:loadMoreDeal' %}",
					success: function(data){
						if (data.status='success'){
							$('#loading').fadeOut();
							console.log(data);
							console.log(data.records);
							for (i in data.records){
							 $('#content').append("<tr>\
								<td>"+data.records[i].title+"</td>\
								<td>"+data.records[i].type+"</td>\
								<td>"+data.records[i].create_time+"</td>\
								<td>"+data.records[i].expire_time+"</td>\
								<td>"+data.records[i].hot_index+"</td>\
								<td>\
									<button type='button' onclick='' class='btn btn-xs btn-info'>详情</button><br>\
									<button type='button' onclick='' class='btn btn-xs btn-warning'>修改</button><br>\
									<button type='button' onclick='' class='btn btn-xs btn-danger'>删除</button><br>\
								</td>\
								</tr>\
								");
						 	};	
							has_next=data.has_next;
							end=data.end;
							if (has_next==false)
								$('#nomoreresults').fadeIn();
						};
					}
				});
			};
		});
	});
</script>
</body>
</html>
